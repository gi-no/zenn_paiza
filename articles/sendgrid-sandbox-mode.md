---
title: "SendGridã®Sandboxãƒ¢ãƒ¼ãƒ‰ã‚’å°å…¥ã—ã¦é–‹ç™ºç’°å¢ƒã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’æŠ‘åˆ¶ã—ãŸè©±"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [sendgrid, email, ruby, sidekiq]
published: false
---

## æƒ³å®šèª­è€…
ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®æ–¹ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã¾ã™ï¼š
- é–‹ç™ºç’°å¢ƒã§ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚³ã‚¹ãƒˆã‚„èª¤é€ä¿¡ãƒªã‚¹ã‚¯ã«æ‚©ã‚“ã§ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- SendGridã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€ã¾ãŸã¯å°å…¥ã‚’æ¤œè¨ã—ã¦ã„ã‚‹é–‹ç™ºãƒãƒ¼ãƒ   
- Ruby on Rails + Sidekiqã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‹ç”¨ã—ã¦ã„ã‚‹æ–¹
- ç’°å¢ƒåˆ¥ã«æŸ”è»Ÿãªãƒ¡ãƒ¼ãƒ«é€ä¿¡åˆ¶å¾¡ã‚’å®Ÿç¾ã—ãŸã„æ–¹

## ã“ã®è¨˜äº‹ã§ä¼ãˆãŸã„ã“ã¨

é–‹ç™ºç’°å¢ƒã§å¤§é‡ã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ãŒå®Ÿéš›ã«é€ä¿¡ã•ã‚Œã¦ã„ãŸå•é¡Œã‚’ã€SendGridã®Sandboxãƒ¢ãƒ¼ãƒ‰ã¨SidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ„ã¿åˆã‚ã›ã§è§£æ±ºã—ã€ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’**ç´„95%å‰Šæ¸›**ã—ã€å¤§å¹…ãªã‚³ã‚¹ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿç¾
2. **èª¤é€ä¿¡ãƒªã‚¹ã‚¯ã‚¼ãƒ­**: é–‹ç™ºç’°å¢ƒã‹ã‚‰ã®å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®èª¤é€ä¿¡ã‚’å®Œå…¨é˜²æ­¢
3. **æŸ”è»Ÿãªåˆ¶å¾¡**: ã‚¸ãƒ§ãƒ–å˜ä½ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³å˜ä½ã§ã®é€ä¿¡åˆ¶å¾¡ã‚’å®Ÿç¾

æœ¬è¨˜äº‹ã§ã¯ã€Sidekiqã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’æ´»ç”¨ã—ãŸå®Ÿè£…æ–¹æ³•ã¨ã€é‹ç”¨ã§å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹ã‚’å…±æœ‰ã—ã¾ã™ã€‚

## ã¯ã˜ã‚ã«ï¼šãªãœSandboxãƒ¢ãƒ¼ãƒ‰ãŒå¿…è¦ã ã£ãŸã®ã‹
### ç›´é¢ã—ã¦ã„ãŸ3ã¤ã®èª²é¡Œ

#### 1. ã‚³ã‚¹ãƒˆå•é¡Œ
- é–‹ç™ºç’°å¢ƒã§å¤§é‡ã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ãŒå®Ÿéš›ã«é€ä¿¡ã•ã‚Œã¦ã„ãŸ
- SendGridã®é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãƒ™ãƒ¼ã‚¹èª²é‡‘ã«ã‚ˆã‚‹ç„¡é§„ãªã‚³ã‚¹ãƒˆç™ºç”Ÿ
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãŸã³ã«èª²é‡‘ãŒç©ã¿ä¸ŠãŒã‚‹çŠ¶æ³

#### 2. èª¤é€ä¿¡ãƒªã‚¹ã‚¯
- é–‹ç™ºç’°å¢ƒã‹ã‚‰å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®èª¤é€ä¿¡ã®å±é™ºæ€§
- æƒ…å ±æ¼æ´©ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æ··ä¹±ã®ãƒªã‚¹ã‚¯
- ä¸€åº¦ã®è¨­å®šãƒŸã‚¹ã§å¤§é‡èª¤é€ä¿¡ã®å¯èƒ½æ€§

å…·ä½“çš„ãªä¾‹ï¼š
- ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæœ¬ç•ªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚“ã§ã„ãŸå ´åˆã€ãƒ†ã‚¹ãƒˆå†…å®¹ãŒå®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹
- é–‹ç™ºç’°å¢ƒã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ãŸéš›ã«ã€èª¤ã£ã¦å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã‚‹  
- ä¸€æ‹¬é€ä¿¡æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã§ã€æ„å›³ã›ãšæœ¬ç•ªãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ãŒé…ä¿¡ã•ã‚Œã‚‹

#### 3. ãƒ†ã‚¹ãƒˆç’°å¢ƒã®åˆ¶ç´„
- å®Ÿéš›ã®é€ä¿¡ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼ã—ãŸã„ãŒã€å®Ÿé€ä¿¡ã¯ã—ãŸããªã„
- ã€Œç¾å®Ÿçš„ãªãƒ†ã‚¹ãƒˆã€ã¨ã€Œå®‰å…¨æ€§ã€ã®ä¸¡ç«‹ãŒå›°é›£
- ç’°å¢ƒã”ã¨ã®æŸ”è»Ÿãªåˆ¶å¾¡ãŒå¿…è¦

## è§£æ±ºç­–ï¼šSendGrid Sandboxãƒ¢ãƒ¼ãƒ‰ã®æ´»ç”¨

### Sandboxãƒ¢ãƒ¼ãƒ‰ã¨ã¯
SendGridã®APIã«å¯¾ã—ã¦é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯è¡Œã†ãŒã€å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

### ğŸ“§ é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ vs Sandboxãƒ¢ãƒ¼ãƒ‰ ã®å‹•ä½œæ¯”è¼ƒ

```mermaid
flowchart LR
  subgraph "é€šå¸¸ãƒ¢ãƒ¼ãƒ‰(æœ¬ç•ªç’°å¢ƒ)"
    App1[ã‚¢ãƒ—ãƒª] -->|APIå‘¼ã³å‡ºã—| SG1[SendGrid]
    SG1 -->|âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡| User1[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    SG1 -.->|200 OK| App1
  end
  
  subgraph "Sandboxãƒ¢ãƒ¼ãƒ‰(é–‹ç™ºç’°å¢ƒ)"
    App2[ã‚¢ãƒ—ãƒª] -->|APIå‘¼ã³å‡ºã—| SG2[SendGrid]
    SG2 -->|âŒ é€ä¿¡ã—ãªã„| Block[ğŸš«]
    SG2 -.->|202 ACCEPTED| App2
  end
  
  style App1 fill:#ffd4d4
  style SG1 fill:#ffd4d4
  style User1 fill:#ffe4e4
  
  style App2 fill:#d4ffd4
  style SG2 fill:#d4ffd4
  style Block fill:#e4ffe4
```

### ãƒã‚¤ãƒ³ãƒˆè§£èª¬

#### é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- ã‚¢ãƒ—ãƒªãŒSendGrid APIã‚’å‘¼ã³å‡ºã™
- SendGridãŒ**å®Ÿéš›ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«å±Šã
- APIã¯ã€Œ200 OKã€ã‚’è¿”ã™

#### Sandboxãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒï¼‰
- ã‚¢ãƒ—ãƒªãŒSendGrid APIã‚’å‘¼ã³å‡ºã™ï¼ˆ**åŒã˜ã‚³ãƒ¼ãƒ‰**ï¼‰
- SendGridã¯**ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ä½•ã‚‚å±Šã‹ãªã„ï¼ˆ**å®‰å…¨**ï¼‰
- APIã¯ã€Œ202 ACCEPTEDã€ã‚’è¿”ã™

## å®Ÿè£…æ–¹é‡ï¼šSidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã‚¸ãƒ§ãƒ–å˜ä½åˆ¶å¾¡
### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ
1. **ç’°å¢ƒåˆ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š**: é–‹ç™º/ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã¯Sandboxæœ‰åŠ¹ã€æœ¬ç•ªã¯ç„¡åŠ¹
2. **ã‚¸ãƒ§ãƒ–å˜ä½ã®åˆ¶å¾¡**: SidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã‚¸ãƒ§ãƒ–ã”ã¨ã«ãƒ•ãƒ©ã‚°ç®¡ç†
3. **ä¾‹å¤–å‡¦ç†**: ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³å®›ãªã©ç‰¹å®šæ¡ä»¶ã§ã®å®Ÿé€ä¿¡ã‚’è¨±å¯
4. **é€éçš„ãªå®Ÿè£…**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«

### ğŸ¯ SidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```mermaid
flowchart LR
  subgraph "ğŸ“¨ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¸ãƒ§ãƒ–ã®æµã‚Œ"
    App[ã‚¢ãƒ—ãƒª] -->|1.ã‚¸ãƒ§ãƒ–ç™»éŒ²| CMW[ğŸ”§ Client MW]
    CMW -->|2.Sandboxãƒ•ãƒ©ã‚°ä»˜ä¸| Redis[(Redis)]
    Redis -->|3.ã‚¸ãƒ§ãƒ–å–å¾—| SMW[ğŸ”§ Server MW]
    SMW -->|4.ãƒ•ãƒ©ã‚°è¨­å®š| Worker[Worker]
    Worker -->|5.ãƒ¡ãƒ¼ãƒ«é€ä¿¡| SG[SendGrid API]
  end
  
  style CMW fill:#ffe4b5
  style SMW fill:#ffe4b5
  style SG fill:#e6f3ff
```

#### å‹•ä½œã®æµã‚Œ
1. **ã‚¸ãƒ§ãƒ–ç™»éŒ²**: ã‚¢ãƒ—ãƒªãŒãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¸ãƒ§ãƒ–ã‚’ç™»éŒ²
2. **ãƒ•ãƒ©ã‚°ä»˜ä¸**: ClientãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒSandboxãƒ•ãƒ©ã‚°ã‚’ã‚¸ãƒ§ãƒ–ã«è¿½åŠ 
3. **ã‚¸ãƒ§ãƒ–ä¿å­˜**: Redisã‚­ãƒ¥ãƒ¼ã«ãƒ•ãƒ©ã‚°ä»˜ãã‚¸ãƒ§ãƒ–ã‚’ä¿å­˜
4. **ãƒ•ãƒ©ã‚°èª­ã¿è¾¼ã¿**: ServerãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒãƒ•ãƒ©ã‚°ã‚’èª­ã¿è¾¼ã¿
5. **APIå‘¼ã³å‡ºã—**: SendGrid APIã«Sandboxãƒ¢ãƒ¼ãƒ‰ä»˜ãã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

## å®Ÿè£…ã®è©³ç´°

### Step 1: ç’°å¢ƒå¤‰æ•°ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
`PREFER_SENDGRID_SANDBOX_MODE` ã‚’ boolean ã§ç®¡ç†ã—ã¾ã™ã€‚

```ruby
# config/sendgrid.rb ãªã©
PREFER_SENDGRID_SANDBOX_MODE = ENV["PREFER_SENDGRID_SANDBOX_MODE"] == "true"
```

### Step 2: Sidekiq ClientãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆã‚¸ãƒ§ãƒ–ç™»éŒ²æ™‚ï¼‰
ã‚¸ãƒ§ãƒ–ã«Sandboxãƒ•ãƒ©ã‚°ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

```ruby
module Sidekiq
  module Middleware
    module Client
      class SendGridSandboxMarker
        # SendGrid ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ã‚¸ãƒ§ãƒ–ã«ä»˜ä¸ã™ã‚‹
        def call(_worker_class, job, _queue, _redis_pool)
          job['prefer_sendgrid_sandbox_mode'] = true if ENV.fetch('PREFER_SENDGRID_SANDBOX_MODE', 'false') == 'true'

          yield
        end
      end
    end
  end
end
```

### Step 3: Sidekiq ServerãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆã‚¸ãƒ§ãƒ–å®Ÿè¡Œæ™‚ï¼‰
Workerå®Ÿè¡Œæ™‚ã«Sandboxãƒ•ãƒ©ã‚°ã‚’Thread localã«è¨­å®šã—ã¾ã™ã€‚

```ruby
module Sidekiq
  module Middleware
    module Server
      # SendGrid ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¨­å®šã™ã‚‹
      class SendGridSandboxFlagger
        # @param worker [Object] å®Ÿè¡Œä¸­ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        # @param job [Hash]    ã‚¸ãƒ§ãƒ–æƒ…å ±
        # @param queue [String] ã‚­ãƒ¥ãƒ¼å
        def call(_worker, job, _queue)
          Thread.current[:sidekiq_prefer_sendgrid_sandbox_mode] = true if job['prefer_sendgrid_sandbox_mode']

          yield
        ensure
          Thread.current[:sidekiq_prefer_sendgrid_sandbox_mode] = nil
        end
      end
    end
  end
end
```

### Step 4: ä¾‹å¤–å‡¦ç†ã®å®Ÿè£…ï¼ˆç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³å®›ã¯å®Ÿé€ä¿¡ï¼‰

```ruby
module SendGridSandbox
  INTERNAL_DOMAINS = ['xxx.jp', 'xxx.co.jp'].freeze

  class << self
    # sandbox ãŒã€Œå®Ÿéš›ã«ã€æœ‰åŠ¹ã‹ã©ã†ã‹åˆ¤å®š
    # ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šãŒæœ‰åŠ¹ã‹ã¤ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å«ã¾ãªã„å ´åˆã®ã¿ true
    # @param recipients [Array<String>] é€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸€è¦§
    # @return [Boolean]
    def enabled?(recipients:)
      sandbox_enabled = Thread.current[:sidekiq_prefer_sendgrid_sandbox_mode] ||
                        ENV.fetch('PREFER_SENDGRID_SANDBOX_MODE', 'false') == 'true'
      return false unless sandbox_enabled

      # ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯ï¼šå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ false
      return false if recipients.any? do |email|
        domain = email.split('@')[1]
        INTERNAL_DOMAINS.include?(domain)
      end

      true # ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå«ã¾ã‚Œã¦ã„ãªã„
    end

    # ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ãŸ SendGrid::MailSettings ã‚’ç”Ÿæˆã—ã¦è¿”ã™
    # @return [::SendGrid::MailSettings]
    def sandbox_mail_settings
      mail_settings = ::SendGrid::MailSettings.new
      mail_settings.sandbox_mode = SendGrid::SandBoxMode.new(enable: true)
      mail_settings
    end
  end
end
```

### Step 5: SendGrid APIå‘¼ã³å‡ºã—æ™‚ã®é©ç”¨

```ruby
    sg_mail = ::SendGrid::Mail.new
    .
    .
    .

    # å…¨å—ä¿¡è€…ã‚’å¯¾è±¡ã«ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãŒæœ‰åŠ¹ã‹åˆ¤å®šã—ã€æœ‰åŠ¹ãªã‚‰è¨­å®šã‚’é©ç”¨
    all_recipients = to_emails | cc_emails | bcc_emails

    # ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªå ´åˆã€SendGridã®MailSettingsã«ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
    if SendGridSandbox.enabled?(recipients: all_recipients)
      sg_mail.mail_settings = SendGridSandbox.sandbox_mail_settings
    end
    .
    .
    .
```

## å°å…¥åŠ¹æœ

### ğŸ“‰ ä¸»è¦æŒ‡æ¨™ã®æ”¹å–„

| æŒ‡æ¨™ | æ”¹å–„çµæœ |
|:---|:---|
| **é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°** | **ç´„95%å‰Šæ¸›** |
| **ã‚³ã‚¹ãƒˆ** | **80%ä»¥ä¸Šå‰Šæ¸›** |
| **èª¤é€ä¿¡ãƒªã‚¹ã‚¯** | **100%é˜²æ­¢** |

### ğŸ“Š ç’°å¢ƒåˆ¥ã®æ”¹å–„åŠ¹æœ

- **é–‹ç™ºç’°å¢ƒãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ**: 95%å‰Šæ¸›ï¼ˆç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³å®›ã®ã¿å®Ÿé€ä¿¡ï¼‰
- **æœ¬ç•ªç’°å¢ƒ**: å½±éŸ¿ãªã—ï¼ˆé€šå¸¸é€šã‚Šé€ä¿¡ï¼‰

ç‰¹ã«é–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®å¤§é‡é…ä¿¡ãƒ†ã‚¹ãƒˆã®é€ä¿¡æŠ‘åˆ¶ãŒå¤§ããè²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚

## é‹ç”¨ä¸Šã®ãƒã‚¤ãƒ³ãƒˆ

### âœ… ãƒ¡ãƒªãƒƒãƒˆ
- ç’°å¢ƒåˆ¥ã®æŸ”è»Ÿãªåˆ¶å¾¡ãŒå¯èƒ½
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ãŒæœ€å°é™
- ã‚¸ãƒ§ãƒ–å˜ä½ã§ã®ç´°ã‹ã„åˆ¶å¾¡ãŒå¯èƒ½
- ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³å®›ãªã©ã®ä¾‹å¤–å‡¦ç†ãŒå®¹æ˜“

### âš ï¸ æ³¨æ„ç‚¹
- Sandboxãƒ¢ãƒ¼ãƒ‰ã§ã‚‚APIãƒªã‚¯ã‚¨ã‚¹ãƒˆèª²é‡‘ã¯ç™ºç”Ÿï¼ˆãŸã ã—å¤§å¹…å‰Šæ¸›ï¼‰
- SMTPçµŒç”±ã®é€ä¿¡ã«ã¯æœªå¯¾å¿œï¼ˆWeb APIã®ã¿ï¼‰  
- æœ¬ç•ªç’°å¢ƒã§ã®èª¤é©ç”¨é˜²æ­¢ã®ãŸã‚ã€ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†ãŒé‡è¦
- ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®è¨­å®šç¢ºèªãŒå¿…é ˆ

## ã¾ã¨ã‚

SendGridã®Sandboxãƒ¢ãƒ¼ãƒ‰ã¨SidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®3ã¤ã®ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸï¼š

### ğŸ¯ é”æˆã—ãŸæˆæœ
1. **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’95%å‰Šæ¸›ã—ã€å¤§å¹…ãªã‚³ã‚¹ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿç¾
2. **ãƒªã‚¹ã‚¯æ’é™¤**: é–‹ç™ºç’°å¢ƒã‹ã‚‰ã®èª¤é€ä¿¡ã‚¼ãƒ­ã‚’å®Ÿç¾  
3. **æŸ”è»Ÿãªåˆ¶å¾¡**: ç’°å¢ƒåˆ¥ãƒ»ã‚¸ãƒ§ãƒ–åˆ¥ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ã®ç´°ã‹ã„åˆ¶å¾¡ã‚’å®Ÿç¾

### ğŸ’¡ å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹

#### æŠ€è¡“é¢
- SidekiqãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ã‚¸ãƒ§ãƒ–å˜ä½åˆ¶å¾¡ãŒéå¸¸ã«åŠ¹æœçš„
- Thread localã‚’æ´»ç”¨ã—ãŸã‚¹ã‚³ãƒ¼ãƒ—é™å®šã®è¨­å®šç®¡ç†ãŒæœ‰åŠ¹
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«ã—ãŸè¨­è¨ˆãŒé‡è¦

#### é‹ç”¨é¢  
- ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹åˆ¶å¾¡ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãŒã‚·ãƒ³ãƒ—ãƒ«ã«
- ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³å®›ã®ä¾‹å¤–å‡¦ç†ãŒæ¤œè¨¼åŠ¹ç‡ã‚’å¤§å¹…æ”¹å–„

### ğŸš€ ä»Šå¾Œã®å±•æœ›
- SMTPçµŒç”±ã®é€ä¿¡ã¸ã®å¯¾å¿œæ¤œè¨
- ä»–ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¨ªå±•é–‹

æœ¬å–ã‚Šçµ„ã¿ã¯ã€ã‚³ã‚¹ãƒˆå‰Šæ¸›ã¨ãƒªã‚¹ã‚¯ä½æ¸›ã‚’ä¸¡ç«‹ã—ãªãŒã‚‰é–‹ç™ºåŠ¹ç‡ã‚’ç¶­æŒã™ã‚‹ã€å®Ÿç”¨çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãªã‚Šã¾ã—ãŸã€‚åŒæ§˜ã®èª²é¡Œã‚’æŠ±ãˆã‚‹ãƒãƒ¼ãƒ ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
